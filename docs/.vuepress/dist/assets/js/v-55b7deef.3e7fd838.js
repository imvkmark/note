"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3340],{9058:(s,e,n)=>{n.r(e),n.d(e,{data:()=>r});const r={key:"v-55b7deef",path:"/os/centos/upgrade-supervisor.html",title:"Centos 使用 pip3 安装/升级 supervisor",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"安装 Python3",slug:"安装-python3",children:[]},{level:2,title:"安装 Supervisor",slug:"安装-supervisor",children:[]},{level:2,title:"参考",slug:"参考",children:[]}],filePathRelative:"os/centos/upgrade-supervisor.md",git:{updatedTime:1629648513e3,contributors:[{name:"duoli",email:"zhaody901@126.com",commits:1}]}}},3174:(s,e,n)=>{n.r(e),n.d(e,{default:()=>g});var r=n(6252);const a=(0,r._)("h1",{id:"centos-使用-pip3-安装-升级-supervisor",tabindex:"-1"},[(0,r._)("a",{class:"header-anchor",href:"#centos-使用-pip3-安装-升级-supervisor","aria-hidden":"true"},"#"),(0,r.Uk)(" Centos 使用 pip3 安装/升级 supervisor")],-1),p=(0,r.Uk)("安装的时候, 因为国内外访问环境不同, 可能会出现国内访问速度慢情况, 可以考虑更换源 : "),l={href:"https://lang-python.wulicode.com/zh_CN/latest/python/mirror.html",target:"_blank",rel:"noopener noreferrer"},i=(0,r.Uk)("更换镜像源 , 加速 python 安装"),t=(0,r.uE)('<h2 id="安装-python3" tabindex="-1"><a class="header-anchor" href="#安装-python3" aria-hidden="true">#</a> 安装 Python3</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ yum install vim git yum-utils python3 python3-devel\n$ pip3 install --upgrade pip\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="安装-supervisor" tabindex="-1"><a class="header-anchor" href="#安装-supervisor" aria-hidden="true">#</a> 安装 Supervisor</h2><p><strong>安装 Supervisor</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ pip3 <span class="token function">install</span> supervisor\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>这里安装完成之后, 执行文件在 <code>/usr/local/bin/</code> 目录下, 这个目录下存在三个文件</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo_supervisord_conf    # 输出配置文件\nsupervisorctl            # supervisor 控制\nsupervisord              # supervisor 守护进程\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果使用 <code>sudo pip3 install --user supervisor</code> 进行安装,则安装的目录会在 <code>~/.local/bin</code> 目录下, 这里我们选择使用 root 用户来安装, 然后运行.</p><p>使用之前版本或者是 yum 安装的版本安装的位置一般会在 <code>/usr/bin</code> 目录下, 如果是多版本 <code>supervisor</code> 可以通过路径来进行区分</p><p><strong>增加配置文件</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># 生成配置文件\n$ echo_supervisord_conf &gt; /etc/supervisord.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>增加服务管理</strong></p><p>使用 <code>systemctl</code> 来启动 supervisor，文件内容</p>',13),o=(0,r.Uk)("文件地址: "),u={href:"https://github.com/Supervisor/initscripts/blob/master/centos-systemd-etcs",target:"_blank",rel:"noopener noreferrer"},c=(0,r.Uk)("initscripts/centos-systemd-etcs"),d=(0,r.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ vim /usr/lib/systemd/system/supervisord.service\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># supervisord service for systemd (CentOS 7.0+)\n# by ET-CS (https://github.com/ET-CS)\n[Unit]\nDescription=Supervisor daemon\n\n[Service]\nType=forking\nExecStart=/usr/local/bin/supervisord -c /etc/supervisord.conf\nExecStop=/usr/local/bin/supervisorctl $OPTIONS shutdown\nExecReload=/usr/local/bin/supervisorctl $OPTIONS reload\nKillMode=process\nRestart=on-failure\nRestartSec=42s\n\n[Install]\nWantedBy=multi-user.target\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>启动 Supervisord</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># 如果对 supervisord.service 中更改了路径, 则需要重新加载内容\n$ systemctl daemon-reload\n$ systemctl start supervisord\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><p><strong>常用的命令</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>supervisorctl stop program\nsupervisorctl start program\nsupervisorctl restart program\nsupervisorctl status\nsupervisorctl reload\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>升级</strong></p><p>升级的逻辑是安装新的版本, 然后删除旧版本</p><p>如果是通过 yum 安装或者 pip(2.x) 版本安装的, 则可以对老板板进行删除</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ yum remove supervisor\n\n# 移除 python2 版本的, 如果 pip 链接到 pip3 , 则无法使用这个进行卸载\n$ pip uninstall supervisor\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>使用非 root 用户来管理supervisor</strong></p><p>由于默认使用非 root 用户启动服务，所以需要单独配置允许其使用。官方这个 Issue 中提到了解决方法：</p>',13),b={href:"https://github.com/Supervisor/supervisor/issues/173#issuecomment-186128727",target:"_blank",rel:"noopener noreferrer"},m=(0,r.Uk)("Permession denied error when use supervisorctl · Issue #173 · Supervisor/supervisor · GitHub"),v=(0,r.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ groupadd supervisor\n$ usermod -aG supervisor doraemon\n\n$ sed -i &quot;s/;chmod=0700/chmod=0770/&quot; /etc/supervisord.conf\n$ sed -i &quot;s/;chown=nobody:nogroup/chown=root:supervisor/&quot; /etc/supervisord.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',1),g={render:function(s,e){const n=(0,r.up)("OutboundLink");return(0,r.wg)(),(0,r.iD)(r.HY,null,[a,(0,r._)("p",null,[p,(0,r._)("a",l,[i,(0,r.Wm)(n)])]),t,(0,r._)("p",null,[o,(0,r._)("a",u,[c,(0,r.Wm)(n)])]),d,(0,r._)("p",null,[(0,r._)("a",b,[m,(0,r.Wm)(n)])]),v],64)}}}}]);