"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[97],{3428:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-8898b090",path:"/nginx/example/expires.html",title:"配置浏览器缓存",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"不缓存",slug:"不缓存",children:[]},{level:2,title:"缓存",slug:"缓存",children:[]},{level:2,title:"根据链接设置缓存时间",slug:"根据链接设置缓存时间",children:[]}],filePathRelative:"nginx/example/expires.md",git:{updatedTime:1629648513e3,contributors:[{name:"duoli",email:"zhaody901@126.com",commits:1}]}}},1634:(n,s,a)=>{a.r(s),a.d(s,{default:()=>p});const e=(0,a(6252).uE)('<h1 id="配置浏览器缓存" tabindex="-1"><a class="header-anchor" href="#配置浏览器缓存" aria-hidden="true">#</a> 配置浏览器缓存</h1><p>使用 <code>expires</code> 参数。</p><h2 id="不缓存" tabindex="-1"><a class="header-anchor" href="#不缓存" aria-hidden="true">#</a> 不缓存</h2><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n    <span class="token directive"><span class="token keyword">expires</span> -1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>输出Response Headers:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Cache-Control:no-cache\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>当文件没有变更时会返回 304 ，有变更时会是 200 ，如果强制命中 200 可以再添加: <code>if_modified_since off;</code> 忽略 Request Headers 里的 <code>If-Modified-Since</code> 字段。</p><h2 id="缓存" tabindex="-1"><a class="header-anchor" href="#缓存" aria-hidden="true">#</a> 缓存</h2><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n    <span class="token directive"><span class="token keyword">expires</span> <span class="token number">1d</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>1d为1天，单位如下:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ms  milliseconds\ns   seconds\nm   minutes\nh   hours\nd   days\nw   weeks\nM   months，30 days\ny   years，365 days\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果希望最大缓存可以:</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n    <span class="token directive"><span class="token keyword">expires</span> max</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>输出Response Headers:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Cache-Control:max-age=315360000\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="根据链接设置缓存时间" tabindex="-1"><a class="header-anchor" href="#根据链接设置缓存时间" aria-hidden="true">#</a> 根据链接设置缓存时间</h2><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n    <span class="token comment"># 设置为1月</span>\n    <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$expires_time</span>           <span class="token number">1M</span></span><span class="token punctuation">;</span>\n\n    <span class="token comment"># 针对后台不缓存</span>\n    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* ^/admin(\\/.*)?$)</span> <span class="token punctuation">{</span>\n        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$expires_time</span>       -1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment"># 针对静态文件缓存最大</span>\n    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* ^/static(\\/.*)?$)</span> <span class="token punctuation">{</span>\n        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$expires_time</span>       max</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment"># 设置吧</span>\n    <span class="token directive"><span class="token keyword">expires</span> <span class="token variable">$expires_time</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div>',17),p={render:function(n,s){return e}}}}]);