<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.25">
    <title>[译] 在 macOS 上升级 Bash | 笔记@小有记</title><meta name="description" content="">
    <link rel="preload" href="/assets/js/runtime~app.ce6e78a5.js" as="script"><link rel="preload" href="/assets/css/styles.c2dbe51e.css" as="style"><link rel="preload" href="/assets/js/2968.6fb6be6b.js" as="script"><link rel="preload" href="/assets/js/app.21ffca0f.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.c2dbe51e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/logo.png" alt="笔记@小有记"><span class="site-name can-hide">笔记@小有记</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/ops/" class="nav-link" aria-label="运维"><!--[--><!--]--> 运维 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/os/" class="nav-link router-link-active" aria-label="系统"><!--[--><!--]--> 系统 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/nginx/" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/mysql/" class="nav-link" aria-label="Mysql"><!--[--><!--]--> Mysql <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/javascript/" class="nav-link" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/ops/" class="nav-link" aria-label="运维"><!--[--><!--]--> 运维 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/os/" class="nav-link router-link-active" aria-label="系统"><!--[--><!--]--> 系统 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/nginx/" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/mysql/" class="nav-link" aria-label="Mysql"><!--[--><!--]--> Mysql <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/javascript/" class="nav-link" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">CentOS</p><ul class=""><li><!--[--><a href="/os/centos/install-php-on-centos.html" class="nav-link sidebar-item" aria-label="CentOS 7 安装 nginx, php, mysql, redis, supervisor 套件"><!--[--><!--]--> CentOS 7 安装 nginx, php, mysql, redis, supervisor 套件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/centos/install-redis5.html" class="nav-link sidebar-item" aria-label="[译] 在 CentOS 7 上安装和配置 Redis 5.x"><!--[--><!--]--> [译] 在 CentOS 7 上安装和配置 Redis 5.x <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/centos/modify-host.html" class="nav-link sidebar-item" aria-label="[转] 如何在CentOS 7上修改主机名"><!--[--><!--]--> [转] 如何在CentOS 7上修改主机名 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/centos/system-install.html" class="nav-link sidebar-item" aria-label="CentOS 进行服务器完善和升级"><!--[--><!--]--> CentOS 进行服务器完善和升级 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/centos/upgrade-curl.html" class="nav-link sidebar-item" aria-label="[转+] CentOS 7 更新 curl 为最新版本"><!--[--><!--]--> [转+] CentOS 7 更新 curl 为最新版本 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/centos/upgrade-supervisor.html" class="nav-link sidebar-item" aria-label="Centos 使用 pip3 安装/升级 supervisor"><!--[--><!--]--> Centos 使用 pip3 安装/升级 supervisor <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Linux</p><ul class=""><li><!--[--><a href="/os/linux/faq.html" class="nav-link sidebar-item" aria-label="Centos 服务器常见问题"><!--[--><!--]--> Centos 服务器常见问题 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/linux/git-ssh-auto-pull.html" class="nav-link sidebar-item" aria-label="Git 代码使用 ssh 进行无密码更新"><!--[--><!--]--> Git 代码使用 ssh 进行无密码更新 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/linux/logrotate.html" class="nav-link sidebar-item" aria-label="[转+] 运维中的日志切割(logrotate)操作梳理"><!--[--><!--]--> [转+] 运维中的日志切割(logrotate)操作梳理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/linux/ssh-login-slow-at-pledge.html" class="nav-link sidebar-item" aria-label="ssh 登录慢，卡顿在 pledge: network 之后"><!--[--><!--]--> ssh 登录慢，卡顿在 pledge: network 之后 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/linux/ssh-login.html" class="nav-link sidebar-item" aria-label="[转+] 设置 SSH 安全通过密钥,免密码登录服务器"><!--[--><!--]--> [转+] 设置 SSH 安全通过密钥,免密码登录服务器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/linux/ssh-port.html" class="nav-link sidebar-item" aria-label="修改 ssh 默认登录的端口"><!--[--><!--]--> 修改 ssh 默认登录的端口 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">Mac</p><ul class=""><li><!--[--><a href="/os/mac/install-brew-slow.html" class="nav-link sidebar-item" aria-label="[转+] macos 安装 homebrew 速度慢或者无法安装"><!--[--><!--]--> [转+] macos 安装 homebrew 速度慢或者无法安装 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/mac/install-php-env.html" class="nav-link sidebar-item" aria-label="[转+] Mac 使用 brew 安装 Nginx、MySQL、PHP-FPM 的 LNMP 开发环境"><!--[--><!--]--> [转+] Mac 使用 brew 安装 Nginx、MySQL、PHP-FPM 的 LNMP 开发环境 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/os/mac/" class="nav-link router-link-active sidebar-item" aria-label="/os/mac/readme.md"><!--[--><!--]--> /os/mac/readme.md <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="[译] 在 macOS 上升级 Bash"><!--[--><!--]--> [译] 在 macOS 上升级 Bash <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#macos上的默认bash版本" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="macOS上的默认Bash版本"><!--[--><!--]--> macOS上的默认Bash版本 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#为什么要升级" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="为什么要升级？"><!--[--><!--]--> 为什么要升级？ <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#如何升级" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="如何升级？"><!--[--><!--]--> 如何升级？ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#安装" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#白名单" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="白名单"><!--[--><!--]--> 白名单 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#设置默认-shell" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="设置默认 Shell"><!--[--><!--]--> 设置默认 Shell <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#重要笔记" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="重要笔记"><!--[--><!--]--> 重要笔记 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#脚本中的用法" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="脚本中的用法"><!--[--><!--]--> 脚本中的用法 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#为什么不能用符号链接" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="为什么不能用符号链接？"><!--[--><!--]--> 为什么不能用符号链接？ <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/os/mac/upgrade-bash.html#参考文献" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="参考文献"><!--[--><!--]--> 参考文献 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="译-在-macos-上升级-bash" tabindex="-1"><a class="header-anchor" href="#译-在-macos-上升级-bash" aria-hidden="true">#</a> [译] 在 macOS 上升级 Bash</h1><blockquote><p>机器翻译, 人工校对, 如有错误, 欢迎斧正 原文地址 : <a href="https://itnext.io/upgrading-bash-on-macos-7138bd1066ba" target="_blank" rel="noopener noreferrer">Upgrading Bash on macOS<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 掘金: https://juejin.im/post/5e4d69c5518825497467f03d</p></blockquote><p>许多 macOS 用户不知道的一件事是，他们正在使用完全过时的 Bash shell 版本。所以，<strong>强烈</strong> 建议在 macOS 上使用较新版本的 Bash，因为它有很多可用的新功能。本文介绍了如何执行此操作。</p><p><img src="/assets/img/15821298484903.05cc019c.jpg" alt=""></p><h2 id="macos上的默认bash版本" tabindex="-1"><a class="header-anchor" href="#macos上的默认bash版本" aria-hidden="true">#</a> macOS上的默认Bash版本</h2><p>要查看 macOS 中包含的 Bash 版本的是否已经过时，请执行以下命令：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ bash --version
GNU bash，版本 3.2.57(1)-release (x86_64-apple-darwin19.0.0)
Copyright (C) 2017 Free Software Foundation, Inc.
许可证 GPLv3+: GNU GPL 许可证第三版或者更新版本 &lt;http://gnu.org/licenses/gpl.html&gt;

本软件是自由软件，你可以自由地更改和重新发布。
在法律许可的情况下特此明示，本软件不提供任何担保。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如你所见，这是 <a href="https://www.gnu.org/software/bash/" target="_blank" rel="noopener noreferrer">GNU Bash<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> <strong>3.2</strong> 版，其日期为 <strong>2007年</strong> ！此版本的Bash包括在<strong>所有</strong> macOS版本中，甚至是最新版。</p><p>苹果在其操作系统中包含如此旧版本的 Bash 的原因与 <strong>许可有关</strong>。从4.0版本（3.2的后继版本）开始，Bash使用 <a href="https://www.gnu.org/licenses/gpl.html" target="_blank" rel="noopener noreferrer">GNU通用公共许可证v3（GPLv3）<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>，Apple不(想)支持。你可以 <a href="https://www.reddit.com/r/apple/comments/7v97ls/why_doesnt_apple_use_any_gpl_v3_unix_packages_in/" target="_blank" rel="noopener noreferrer">在此处<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 和 <a href="http://meta.ath0.com/2012/02/05/apples-great-gpl-purge/" target="_blank" rel="noopener noreferrer">此处<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 找到有关此 <a href="https://www.reddit.com/r/apple/comments/7v97ls/why_doesnt_apple_use_any_gpl_v3_unix_packages_in/" target="_blank" rel="noopener noreferrer">问题<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 的一些讨论。GNU Bash 的 3.2 版是 Apple 接受的带有 GPLv2 的最新版本，因此坚持使用这个版本。</p><p>这意味着整个世界（例如Linux）都将使用 Bash 的新版本，而 macOS 用户则只能使用十年前的旧版本。在撰写本文时，GNU Bash的最新版本是5.0（请参阅 <a href="https://tiswww.case.edu/php/chet/bash/bashtop.html#CurrentStatus" target="_blank" rel="noopener noreferrer">此处<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> ），已于2019年1月发布。在本文中，我给出了将系统的默认 Shell 升级到 Bash 的最新版本的说明。</p><h2 id="为什么要升级" tabindex="-1"><a class="header-anchor" href="#为什么要升级" aria-hidden="true">#</a> 为什么要升级？</h2><p>但如果 Bash 3.2 可以正常工作，为什么还要费心升级新版呢？就我个人而言，主要原因是 <a href="https://www.gnu.org/software/bash/manual/html_node/Programmable-Completion.html" target="_blank" rel="noopener noreferrer"><strong>编程补全</strong><span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。Bash 有个新特性是支持 特定命令的自动补全。你可能会使用自动补全功能来完成命令，文件名和变量，方法是先键入然后敲击 <em>Tab键</em> 以自动完成当前词句（或两次敲击 <em>Tab键</em> 以获取所有可能补全的列表，如果有多个以上的话） ）。这是Bash的自动补全。</p><p>但是，<strong>编程补全</strong> 远不止于此，因为它允许依赖于上下文的特定于命令的完成。例如，想象一下，键入<code>cmd -[tab][tab]</code>，然后看到适用于该命令的所有选项的列表。或键入<code>cmd host rm [tab][tab]</code>然后查看某个配置文件中指定的所有“主机”的列表。<strong>编程补全</strong> 可以做到这一点。</p><p>可编程补全逻辑（由命令的创建者）在完成规范中定义，通常以<strong>完成脚本</strong>的形式定义。这些完成脚本必须在Shell中提供，以启用命令的完成功能。</p><p>问题在于，自3.2版以来，Bash 的可编程补全功能已得到扩展，并且大多数补全脚本都使用这些新功能。这意味着这些补全脚本在 Bash 3.2 上不起作用，这意味着如果你继续使用默认的macOS shell，则会错过许多命令的补全功能。</p><p>通过升级到较新的 Bash 版本，你可以使用这些补全脚本，这将非常有用。我写了整篇文章，称为<a href="https://medium.com/@weibeld/programmable-completion-for-bash-on-macos-f81a0103080b" target="_blank" rel="noopener noreferrer"><strong>macOS 上的 Bash 编程补全</strong><span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>，其中介绍了升级到较新的Bash版本后要充分利用 macOS 上的可编程补全所需的全部知识。</p><h2 id="如何升级" tabindex="-1"><a class="header-anchor" href="#如何升级" aria-hidden="true">#</a> 如何升级？</h2><p>要将 macOS 系统的默认 Shell 升级到最新版本的 Bash，你必须做三件事：</p><ol><li><strong>安装最新版本的Bash</strong></li><li><strong>将新的Bash Whitelist” 作为 login shell</strong></li><li><strong>将新的Bash设置为 default shell</strong></li></ol><p>每个步骤都非常容易，如下所述。</p><blockquote><p>**注意：**以下说明不会更改 Bash 的旧版本，而是安装新版本并将其设置为默认版本。这两个版本将在你的系统上并存，但是你可以从此处忽略旧版本。</p></blockquote><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h3><p>我建议使用<a href="https://brew.sh/" target="_blank" rel="noopener noreferrer">Homebrew<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>安装最新版本的Bash：</p><p><strong>brew安装bash</strong></p><p>就是这样！</p><p>要验证安装，你可以检查系统上现在有两个版本的Bash：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ which -a bash
/usr/local/bin/bash
/bin/bash
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第一个是新版本，第二个是旧版本：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ /usr/local/bin/bash --version
GNU bash, version 5.0.0(1)-release (x86_64-apple-darwin18.2.0)
Copyright (C) 2019 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software; you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
$ /bin/bash --version
GNU bash, version 3.2.57(1)-release (x86_64-apple-darwin18)
Copyright (C) 2007 Free Software Foundation, Inc.
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在<code>PATH</code>变量中, 默认的新版 <code>/usr/local/bin</code> 目录的 Path 路径 会在 旧版本 <code>/bin</code> 目录之前，因此，只需输入 <code>bash</code> 即可使用新版</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ bash --version
GNU bash, version 5.0.0(1)-release (x86_64-apple-darwin18.2.0)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>到目前为止，一切安好。现在，你已将此版本设置为默认版本。</p><h3 id="白名单" tabindex="-1"><a class="header-anchor" href="#白名单" aria-hidden="true">#</a> 白名单</h3><p>UNIX包含一项安全功能，该功能将可用作 <a href="https://docstore.mik.ua/orelly/unix3/upt/ch03_04.htm" target="_blank" rel="noopener noreferrer">login shell<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>（即登录系统后使用的 shell 程序）的 Shell 程序限制在 “受信任” Shell 程序列表中。这些 Shell 在<code>[/etc/shells](https://bash.cyberciti.biz/guide//etc/shells)</code>文件中列出。</p><p>由于你要将新设置的 Bash Shell 用作默认 Shell，因此它必须能够充当登录Shell。这意味着，你必须将其添加到 <code>/etc/shells</code> 文件中。你可以以root用户身份编辑此文件：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ sudo vim /etc/shells
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>并将 <code>/usr/local/bin/bash</code> Shell 添加到其内容中，以便文件看起来像这样：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/bin/bash
/bin/csh
/bin/ksh
/bin/sh
/bin/tcsh
/bin/zsh
/usr/local/bin/bash
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这就是这一步需要做的！</p><h3 id="设置默认-shell" tabindex="-1"><a class="header-anchor" href="#设置默认-shell" aria-hidden="true">#</a> 设置默认 Shell</h3><p>此时，如果打开一个新的终端窗口，则仍会使用Bash 3.2。这是因为 <code>/bin/bash</code> 仍设置为默认 Shell 程序。要将其更改为新的shell，请执行以下命令：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ chsh -s /usr/local/bin/bash
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>就这样, 现在，当前用户的默认 Shell 程序设置为 Bash 的新版本。如果关闭并重新打开终端窗口，则现在应该已经在使用新版本。你可以如下验证：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ echo $BASH_VERSION
5.0.0(1)-release
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>该 <code>chsh</code> 命令仅为执行命令的用户(当前用户)更改默认 Shell 程序。如果你也想更改其他用户的默认 Shell ，则可以通过登录其他用户的身份（例如，使用<code>[su](https://en.wikipedia.org/wiki/Su_(Unix))</code>）来重复此命令。最重要的是，也许你可​​能想要更改 root 用户的默认 Shell 程序，你可以执行以下操作：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ sudo chsh -s /usr/local/bin/bash
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>这样，如果你 <code>sudo su</code> 以 root 用户身份打开 Shell ，它将使用新的 Bash 版本。</p><h2 id="重要笔记" tabindex="-1"><a class="header-anchor" href="#重要笔记" aria-hidden="true">#</a> 重要笔记</h2><h3 id="脚本中的用法" tabindex="-1"><a class="header-anchor" href="#脚本中的用法" aria-hidden="true">#</a> 脚本中的用法</h3><p>如前所述，你没有更改 Bash 的默认版本，而是安装了新版本并将其设置为默认版本。Bash的两个版本在你的系统上并存：</p><ul><li><code>/bin/bash</code>： 旧版本</li><li><code>/usr/local/bin/bash</code>： 新版本</li></ul><p>在shell脚本中，你经常会有一个<a href="https://en.wikipedia.org/wiki/Shebang_(Unix)" target="_blank" rel="noopener noreferrer">shebang<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>行，如以下脚本所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#!/bin/bash
echo $BASH_VERSION
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>请务必注意，该shebang行<em>明确</em>引用了Bash 的<strong>旧</strong>版本（因为它指定了<code>/bin/bash</code>）。这意味着，如果你运行此脚本，它将由Bash的旧版本解释（你可以在脚本的输出中看到它，类似于<code>3.2.57(1)-release</code>）。</p><p>在大多数情况下，这可能不是问题。但是，如果你希望脚本由<strong>新</strong>版本的Bash 显式解释，则可以更改shebang行，如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#!/usr/local/bin/bash
echo $BASH_VERSION
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>现在的输出将是<code>5.0.0(1)-release</code>。但是，请注意，该解决方案是<strong>不可移植的</strong>，这意味着它可能无法在其他系统上运行。这是因为，其他系统可能没有位于其中的shell <code>/usr/local/bin/bash</code>（而<code>/bin/bash</code>这几乎是一个标准）。</p><p>结合两全其美，可以使用以下shebang行：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ sudo rm /bin/bash
$ sudo ln -s /usr/local/bin/bash /bin/bash
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对于shebang行，这是<a href="https://www.cyberciti.biz/tips/finding-bash-perl-python-portably-using-env.html" target="_blank" rel="noopener noreferrer">推荐的<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>格式。它通过检查 <code>PATH</code> 和使用第一个遇到的 <code>bash</code> 可执行文件作为脚本的解释器来工作。如果新版本的目录位于中的旧版本目录<code>PATH</code>（默认值）之前，则将使用新版本，并且脚本的输出将类似于<code>5.0.0(1)-release</code>。</p><h3 id="为什么不能用符号链接" tabindex="-1"><a class="header-anchor" href="#为什么不能用符号链接" aria-hidden="true">#</a> 为什么不能用符号链接？</h3><p>为了不处理两个版本的 Bash，你是否能删除旧版本并将新版本放到旧的位置？例如，通过在 <code>/bin/bash</code> 其中创建指向新版本的符号链接，如下所示？</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ sudo rm /bin/bash
$ sudo ln -s /usr/local/bin/bash /bin/bash
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这样，即使是带有脚本的脚本 <code>#!/bin/bash</code> 也会被新版本的Bash解释，那么为什么不这样做呢？</p><p>你可以执行此操作，但是你必须避开名为<a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/System_Integrity_Protection_Guide/Introduction/Introduction.html" target="_blank" rel="noopener noreferrer"><strong>系统完整性保护（SIP）</strong><span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>** **（<a href="https://en.wikipedia.org/wiki/System_Integrity_Protection" target="_blank" rel="noopener noreferrer">Wikipedia<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>）的macOS安全功能。此功能甚至禁止 root 用户对某些目录进行写访问（这就是为什么它也称为 “rootless(root 无权限)”）的原因。这些目录在<a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/System_Integrity_Protection_Guide/FileSystemProtections/FileSystemProtections.html" target="_blank" rel="noopener noreferrer">这里<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 列出并包括 <code>/bin</code> 。这意味着即使以root用户身份，你也无法执行上述命令，因为不允许你从中删除任何内容或在 <code>/bin</code> 中创建任何文件。</p><p>解决方法是禁用SIP，在 <code>/bin</code> 中进行更改，然后再次启用SIP。可以根据<a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/System_Integrity_Protection_Guide/ConfiguringSystemIntegrityProtection/ConfiguringSystemIntegrityProtection.html" target="_blank" rel="noopener noreferrer">这里<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>的说明启用和禁用SIP 。它要求你将计算机引导至<strong>恢复模式</strong>，然后使用 <code>csrutil disable</code> 和 <code>csrutil enable</code> 命令。无论你想通过这个 <strong>特别复杂的方式</strong> 来完全替换旧的 Bash 版本，或者是接受同时使用两个Bash版本，则都取决于你。</p><h2 id="参考文献" tabindex="-1"><a class="header-anchor" href="#参考文献" aria-hidden="true">#</a> 参考文献</h2><ul><li><a href="https://apple.stackexchange.com/a/292760" target="_blank" rel="noopener noreferrer">https://apple.stackexchange.com/a/292760<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2021/8/23 上午12:08:33</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: zhaody901@126.com">duoli</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/os/mac/" class="nav-link router-link-active" aria-label="/os/mac/readme.md"><!--[--><!--]--> /os/mac/readme.md <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.ce6e78a5.js" defer></script><script src="/assets/js/2968.6fb6be6b.js" defer></script><script src="/assets/js/app.21ffca0f.js" defer></script>
  </body>
</html>
